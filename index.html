<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob:;">
    <title>Advanced Resume Template Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Roboto:wght@300;400;500;700;900&family=Open+Sans:wght@300;400;600;700;800&family=Lato:wght@300;400;700;900&family=Montserrat:wght@300;400;600;700;800;900&family=Playfair+Display:wght@400;700;900&family=Merriweather:wght@300;400;700;900&family=Source+Sans+Pro:wght@300;400;600;700;900&family=Raleway:wght@300;400;600;700;800;900&family=Poppins:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a1f3a 0%, #0d1227 100%);
            color: #fff;
            overflow-x: hidden;
        }

        .builder-container {
            display: grid;
            grid-template-columns: 400px 1fr;
            height: 100vh;
        }

        .controls-panel {
            background: rgba(13, 18, 39, 0.95);
            border-right: 2px solid rgba(196, 30, 58, 0.3);
            overflow-y: auto;
            padding: 20px;
        }

        .controls-panel::-webkit-scrollbar {
            width: 8px;
        }

        .controls-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .controls-panel::-webkit-scrollbar-thumb {
            background: rgba(196, 30, 58, 0.5);
            border-radius: 4px;
        }

        .preview-panel {
            background: #f5f5f5;
            overflow: auto;
            position: relative;
        }

        .builder-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(196, 30, 58, 0.3);
        }

        .builder-header h1 {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, #c41e3a 0%, #ff6b6b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .builder-header p {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .control-section {
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .control-section h2 {
            font-size: 16px;
            font-weight: 700;
            color: #c41e3a;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-section h2::before {
            content: 'â–¸';
            font-size: 14px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
        }

        .control-group input[type="text"],
        .control-group input[type="email"],
        .control-group input[type="tel"],
        .control-group input[type="url"],
        .control-group textarea,
        .control-group select {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #fff;
            font-size: 13px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s;
        }

        .control-group input[type="text"]:focus,
        .control-group input[type="email"]:focus,
        .control-group input[type="tel"]:focus,
        .control-group input[type="url"]:focus,
        .control-group textarea:focus,
        .control-group select:focus {
            outline: none;
            border-color: #c41e3a;
            background: rgba(255, 255, 255, 0.08);
        }

        .control-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .control-group input[type="color"] {
            width: 100%;
            height: 40px;
            padding: 4px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            cursor: pointer;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #c41e3a;
            border-radius: 50%;
            cursor: pointer;
        }

        .control-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #c41e3a;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .range-value {
            display: inline-block;
            margin-left: 10px;
            font-size: 12px;
            color: #c41e3a;
            font-weight: 600;
        }

        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #c41e3a 0%, #ff6b6b 100%);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(196, 30, 58, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 25px rgba(255, 255, 255, 0.1);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
            margin-top: 5px;
            width: auto;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .section-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .section-item-title {
            font-weight: 600;
            font-size: 13px;
        }

        .section-item-controls {
            display: flex;
            gap: 5px;
        }

        .icon-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: rgba(196, 30, 58, 0.3);
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab.active {
            background: linear-gradient(135deg, #c41e3a 0%, #ff6b6b 100%);
            color: #fff;
            border-color: transparent;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .preview-frame {
            background: white;
            min-height: 100%;
            transform-origin: top left;
        }

        .three-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .three-option:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .three-option.selected {
            border-color: #c41e3a;
            background: rgba(196, 30, 58, 0.1);
        }

        .three-option input[type="radio"] {
            accent-color: #c41e3a;
        }

        .three-option-label {
            font-size: 13px;
            font-weight: 500;
        }

        .skill-entry {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }

        .skill-entry input {
            padding: 8px;
            font-size: 12px;
        }

        .background-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .bg-option {
            padding: 30px 10px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
        }

        .bg-option.selected {
            border-color: #c41e3a;
            box-shadow: 0 0 15px rgba(196, 30, 58, 0.3);
        }

        .action-buttons {
            position: sticky;
            bottom: 0;
            background: rgba(13, 18, 39, 0.98);
            padding: 20px;
            margin: -20px;
            margin-top: 20px;
            border-top: 2px solid rgba(196, 30, 58, 0.3);
        }

        .success-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .collapsible-section {
            margin-bottom: 10px;
        }

        .collapsible-header {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .collapsible-header:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-content.open {
            max-height: 2000px;
            padding: 15px 0;
        }

        .toggle-icon {
            transition: transform 0.3s;
        }

        .toggle-icon.open {
            transform: rotate(90deg);
        }

        /* Fix dropdown option text visibility - override inline styles */
        select {
            background: rgba(255,255,255,0.2) !important;
            color: #fff !important;
        }

        select option {
            background-color: #fff !important;
            color: #000 !important;
            padding: 4px 8px !important;
        }

        /* Selected option styling */
        select option:checked {
            background-color: #4a90e2 !important;
            color: #fff !important;
        }
    </style>
</head>
<body>
    <div class="builder-container">
        <!-- Controls Panel -->
        <div class="controls-panel">
            <div class="builder-header">
                <h1>Resume Template Builder</h1>
                <p>Customize every aspect of your resume</p>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" data-tab="personal">Personal Info</div>
                <div class="tab" data-tab="colors">Colors</div>
                <div class="tab" data-tab="typography">Typography</div>
                <div class="tab" data-tab="hover">Hover Effects</div>
                <div class="tab" data-tab="icons">Icons</div>
                <div class="tab" data-tab="threejs">3D Effects</div>
                <div class="tab" data-tab="background">Background</div>
                <div class="tab" data-tab="sections">Sections</div>
                <div class="tab" data-tab="skills">Skills</div>
                <div class="tab" data-tab="advanced">Advanced</div>
            </div>

            <!-- Tab Contents -->
            <div class="tab-content active" id="personal-tab">
                <div class="control-section">
                    <h2>Basic Information</h2>
                    <div class="control-group">
                        <label>Full Name</label>
                        <input type="text" id="fullName" placeholder="Your Full Name">
                    </div>
                    <div class="control-group">
                        <label>Professional Title</label>
                        <input type="text" id="jobTitle" placeholder="e.g., Software Engineer">
                    </div>
                    <div class="control-group">
                        <label>Email</label>
                        <input type="email" id="email" placeholder="your.email@example.com">
                    </div>
                    <div class="control-group">
                        <label>Phone</label>
                        <input type="tel" id="phone" placeholder="(555) 123-4567">
                    </div>
                    <div class="control-group">
                        <label>Location</label>
                        <input type="text" id="location" placeholder="City, State">
                    </div>
                    <div class="control-group">
                        <label>LinkedIn URL</label>
                        <input type="url" id="linkedin" placeholder="https://linkedin.com/in/yourprofile">
                    </div>
                    <div class="control-group">
                        <label>Portfolio/Website</label>
                        <input type="url" id="website" placeholder="https://yourwebsite.com">
                    </div>
                </div>

                <div class="control-section">
                    <h2>Professional Summary</h2>
                    <div class="control-group">
                        <textarea id="summary" placeholder="Write a compelling summary about yourself..."></textarea>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="colors-tab">
                <div class="control-section">
                    <h2>Color Scheme</h2>
                    <div class="color-grid">
                        <div class="control-group">
                            <label>Primary Accent</label>
                            <input type="color" id="accentColor" value="#c41e3a">
                        </div>
                        <div class="control-group">
                            <label>Secondary Accent</label>
                            <input type="color" id="secondaryColor" value="#ff6b6b">
                        </div>
                        <div class="control-group">
                            <label>Background Start</label>
                            <input type="color" id="bgColorStart" value="#0d1227">
                        </div>
                        <div class="control-group">
                            <label>Background End</label>
                            <input type="color" id="bgColorEnd" value="#1a1f3a">
                        </div>
                        <div class="control-group">
                            <label>Text Color</label>
                            <input type="color" id="textColor" value="#333333">
                        </div>
                        <div class="control-group">
                            <label>Heading Color</label>
                            <input type="color" id="headingColor" value="#1a1f3a">
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h2>Transparency</h2>
                    <div class="control-group">
                        <label>Resume Sheet Opacity <span class="range-value" id="sheetOpacityValue">100%</span></label>
                        <input type="range" id="sheetOpacity" min="0" max="100" value="100">
                    </div>
                    <div class="control-group">
                        <label>Background Opacity <span class="range-value" id="bgOpacityValue">100%</span></label>
                        <input type="range" id="bgOpacity" min="0" max="100" value="100">
                    </div>
                </div>
            </div>

            <div class="tab-content" id="typography-tab">
                <div class="control-section">
                    <h2>Font Family</h2>
                    <div class="control-group">
                        <label>Select Font</label>
                        <select id="fontFamily" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px;">
                            <option value="Inter">Inter (Default)</option>
                            <option value="Roboto">Roboto</option>
                            <option value="Open Sans">Open Sans</option>
                            <option value="Lato">Lato</option>
                            <option value="Montserrat">Montserrat</option>
                            <option value="Playfair Display">Playfair Display</option>
                            <option value="Merriweather">Merriweather</option>
                            <option value="Source Sans Pro">Source Sans Pro</option>
                            <option value="Raleway">Raleway</option>
                            <option value="Poppins">Poppins</option>
                        </select>
                    </div>
                </div>

                <div class="control-section">
                    <h2>Font Sizes</h2>
                    <div class="control-group">
                        <label>Main Heading Size <span class="range-value" id="headingSizeValue">48px</span></label>
                        <input type="range" id="headingSize" min="24" max="72" value="48">
                    </div>
                    <div class="control-group">
                        <label>Section Heading Size <span class="range-value" id="subheadingSizeValue">24px</span></label>
                        <input type="range" id="subheadingSize" min="16" max="36" value="24">
                    </div>
                    <div class="control-group">
                        <label>Body Text Size <span class="range-value" id="bodySizeValue">14px</span></label>
                        <input type="range" id="bodySize" min="10" max="20" value="14">
                    </div>
                </div>

                <div class="control-section">
                    <h2>Font Weights</h2>
                    <div class="control-group">
                        <label>Heading Weight <span class="range-value" id="headingWeightValue">800</span></label>
                        <input type="range" id="headingWeight" min="300" max="900" value="800" step="100">
                    </div>
                    <div class="control-group">
                        <label>Body Weight <span class="range-value" id="bodyWeightValue">400</span></label>
                        <input type="range" id="bodyWeight" min="300" max="700" value="400" step="100">
                    </div>
                </div>

                <div class="control-section">
                    <h2>Typography Details</h2>
                    <div class="control-group">
                        <label>Letter Spacing <span class="range-value" id="letterSpacingValue">0px</span></label>
                        <input type="range" id="letterSpacing" min="-2" max="4" value="0" step="0.5">
                    </div>
                    <div class="control-group">
                        <label>Line Height <span class="range-value" id="lineHeightValue">1.6</span></label>
                        <input type="range" id="lineHeight" min="1.0" max="2.5" value="1.6" step="0.1">
                    </div>
                </div>

                <div class="control-section">
                    <h2>Text Transform</h2>
                    <div class="control-group">
                        <label>Heading Transform</label>
                        <select id="headingTransform" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px;">
                            <option value="none">Normal</option>
                            <option value="uppercase">UPPERCASE</option>
                            <option value="lowercase">lowercase</option>
                            <option value="capitalize">Capitalize Each Word</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Header Alignment</label>
                        <select id="headerAlignment" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px;">
                            <option value="left">Left</option>
                            <option value="center" selected>Center</option>
                            <option value="right">Right</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="hover-tab">
                <div class="control-section">
                    <h2>Hover Effects</h2>
                    <div class="control-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="hoverEnabled" checked>
                            Enable Hover Effects
                        </label>
                    </div>
                    <div class="control-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="sectionHover" checked>
                            Section Hover Animation
                        </label>
                    </div>
                </div>

                <div class="control-section">
                    <h2>Hover Style</h2>
                    <div class="control-group">
                        <label>Hover Background Color</label>
                        <input type="color" id="hoverColor" value="#f8f9fa">
                    </div>
                    <div class="control-group">
                        <label>Animation Type</label>
                        <select id="hoverAnimation" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px;">
                            <option value="fade">Fade</option>
                            <option value="lift">Lift Up</option>
                            <option value="scale">Scale</option>
                            <option value="glow">Glow</option>
                        </select>
                    </div>
                </div>

                <div class="control-section">
                    <h2>Hover Shadow</h2>
                    <div class="control-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="hoverShadowEnabled" checked>
                            Enable Shadow on Hover
                        </label>
                    </div>
                    <div class="control-group">
                        <label>Shadow Horizontal <span class="range-value" id="hoverShadowHValue">0px</span></label>
                        <input type="range" id="hoverShadowH" min="-20" max="20" value="0">
                    </div>
                    <div class="control-group">
                        <label>Shadow Vertical <span class="range-value" id="hoverShadowVValue">4px</span></label>
                        <input type="range" id="hoverShadowV" min="0" max="30" value="4">
                    </div>
                    <div class="control-group">
                        <label>Shadow Blur <span class="range-value" id="hoverShadowBlurValue">12px</span></label>
                        <input type="range" id="hoverShadowBlur" min="0" max="50" value="12">
                    </div>
                    <div class="control-group">
                        <label>Shadow Color</label>
                        <input type="color" id="hoverShadowColor" value="#c41e3a">
                    </div>
                </div>
            </div>

            <div class="tab-content" id="icons-tab">
                <div class="control-section">
                    <h2>Icon Settings</h2>
                    <div class="control-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="iconsEnabled" checked>
                            Show Contact Icons
                        </label>
                    </div>
                    <div class="control-group">
                        <label>Icon Size <span class="range-value" id="iconSizeValue">14px</span></label>
                        <input type="range" id="iconSize" min="10" max="24" value="14">
                    </div>
                    <div class="control-group">
                        <label>Icon Position</label>
                        <select id="iconPosition" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px;">
                            <option value="left">Left of Text</option>
                            <option value="right">Right of Text</option>
                        </select>
                    </div>
                </div>

                <div class="control-section">
                    <h2>Custom Icons</h2>
                    <p style="font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 15px;">
                        Enter emoji or unicode character for each contact type
                    </p>
                    <div class="control-group">
                        <label>Email Icon</label>
                        <input type="text" id="iconEmail" value="âœ‰" maxlength="2" style="font-size: 18px;">
                    </div>
                    <div class="control-group">
                        <label>Phone Icon</label>
                        <input type="text" id="iconPhone" value="â˜Ž" maxlength="2" style="font-size: 18px;">
                    </div>
                    <div class="control-group">
                        <label>Location Icon</label>
                        <input type="text" id="iconLocation" value="ðŸ“" maxlength="2" style="font-size: 18px;">
                    </div>
                    <div class="control-group">
                        <label>LinkedIn Icon</label>
                        <input type="text" id="iconLinkedin" value="ðŸ’¼" maxlength="2" style="font-size: 18px;">
                    </div>
                    <div class="control-group">
                        <label>Website Icon</label>
                        <input type="text" id="iconWebsite" value="ðŸŒ" maxlength="2" style="font-size: 18px;">
                    </div>
                </div>
            </div>

            <div class="tab-content" id="threejs-tab">
                <div class="control-section">
                    <h2>3D Visualization</h2>
                    <div class="three-option selected" data-effect="none">
                        <input type="radio" name="threeEffect" value="none" checked>
                        <span class="three-option-label">None (Canvas 2D Only)</span>
                    </div>
                    <div class="three-option" data-effect="particles">
                        <input type="radio" name="threeEffect" value="particles">
                        <span class="three-option-label">Floating Particles</span>
                    </div>
                    <div class="three-option" data-effect="waves">
                        <input type="radio" name="threeEffect" value="waves">
                        <span class="three-option-label">Animated Waves</span>
                    </div>
                    <div class="three-option" data-effect="geometry">
                        <input type="radio" name="threeEffect" value="geometry">
                        <span class="three-option-label">Rotating Geometry</span>
                    </div>
                    <div class="three-option" data-effect="network">
                        <input type="radio" name="threeEffect" value="network">
                        <span class="three-option-label">Network Connections</span>
                    </div>
                    <div class="three-option" data-effect="galaxy">
                        <input type="radio" name="threeEffect" value="galaxy">
                        <span class="three-option-label">Galaxy Spiral</span>
                    </div>
                </div>

                <div class="control-section">
                    <h2>Effect Settings</h2>
                    <div class="control-group">
                        <label>Animation Speed <span class="range-value" id="animSpeedValue">50%</span></label>
                        <input type="range" id="animSpeed" min="0" max="100" value="50">
                    </div>
                    <div class="control-group">
                        <label>Particle Count <span class="range-value" id="particleCountValue">1000</span></label>
                        <input type="range" id="particleCount" min="100" max="5000" value="1000" step="100">
                    </div>
                    <div class="control-group">
                        <label>Effect Color</label>
                        <input type="color" id="effectColor" value="#c41e3a">
                    </div>
                </div>
            </div>

            <div class="tab-content" id="background-tab">
                <div class="control-section">
                    <h2>Background Type</h2>
                    <div class="background-options">
                        <div class="bg-option selected" data-bg="gradient" style="background: linear-gradient(135deg, #0d1227 0%, #1a1f3a 100%);">
                            Gradient
                        </div>
                        <div class="bg-option" data-bg="solid" style="background: #1a1f3a;">
                            Solid Color
                        </div>
                        <div class="bg-option" data-bg="pattern" style="background: repeating-linear-gradient(45deg, #0d1227, #0d1227 10px, #1a1f3a 10px, #1a1f3a 20px);">
                            Pattern
                        </div>
                        <div class="bg-option" data-bg="image" style="background: linear-gradient(rgba(13,18,39,0.8), rgba(13,18,39,0.8)), url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22><rect width=%2240%22 height=%2240%22 fill=%22%231a1f3a%22/><circle cx=%2220%22 cy=%2220%22 r=%222%22 fill=%22%23c41e3a%22/></svg>');">
                            Image
                        </div>
                    </div>
                </div>

                <div class="control-section" id="imageUploadSection" style="display: none;">
                    <h2>Background Image</h2>
                    <div class="control-group">
                        <label>Upload Image</label>
                        <input type="file" id="bgImageUpload" accept="image/*" style="color: #fff;">
                    </div>
                    <div class="control-group">
                        <label>Image Overlay Opacity <span class="range-value" id="imgOverlayValue">80%</span></label>
                        <input type="range" id="imgOverlay" min="0" max="100" value="80">
                    </div>
                </div>
            </div>

            <div class="tab-content" id="sections-tab">
                <div class="control-section">
                    <h2>Resume Sections</h2>
                    <p style="font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 15px;">
                        Add, remove, and reorder sections for your resume
                    </p>
                    <div id="sectionsList">
                        <!-- Sections will be dynamically added here -->
                    </div>
                    <button class="btn btn-secondary" id="addSectionBtn">+ Add New Section</button>
                </div>
            </div>

            <div class="tab-content" id="skills-tab">
                <div class="control-section">
                    <h2>Technical Skills</h2>
                    <p style="font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 15px;">
                        Add skills with proficiency levels (0-100)
                    </p>
                    <div id="skillsList">
                        <!-- Skills will be dynamically added here -->
                    </div>
                    <button class="btn btn-secondary btn-small" id="addSkillBtn">+ Add Skill</button>
                </div>
            </div>

            <div class="tab-content" id="advanced-tab">
                <div class="control-section">
                    <h2>Spacing</h2>
                    <div class="control-group">
                        <label>Section Margin <span class="range-value" id="sectionMarginValue">35px</span></label>
                        <input type="range" id="sectionMargin" min="0" max="60" value="35">
                    </div>
                    <div class="control-group">
                        <label>Section Padding <span class="range-value" id="sectionPaddingValue">0px</span></label>
                        <input type="range" id="sectionPadding" min="0" max="30" value="0">
                    </div>
                    <div class="control-group">
                        <label>Header Padding <span class="range-value" id="headerPaddingValue">30px</span></label>
                        <input type="range" id="headerPadding" min="10" max="60" value="30">
                    </div>
                </div>

                <div class="control-section">
                    <h2>Borders</h2>
                    <div class="control-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="bordersEnabled" checked>
                            Enable Borders
                        </label>
                    </div>
                    <div class="control-group">
                        <label>Header Border Width <span class="range-value" id="headerBorderValue">3px</span></label>
                        <input type="range" id="headerBorder" min="0" max="10" value="3">
                    </div>
                    <div class="control-group">
                        <label>Section Border Width <span class="range-value" id="sectionBorderValue">2px</span></label>
                        <input type="range" id="sectionBorder" min="0" max="10" value="2">
                    </div>
                    <div class="control-group">
                        <label>Border Style</label>
                        <select id="borderStyle" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px;">
                            <option value="solid">Solid</option>
                            <option value="dashed">Dashed</option>
                            <option value="dotted">Dotted</option>
                            <option value="double">Double</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Border Radius <span class="range-value" id="borderRadiusValue">8px</span></label>
                        <input type="range" id="borderRadius" min="0" max="30" value="8">
                    </div>
                </div>

                <div class="control-section">
                    <h2>Container Shadow</h2>
                    <div class="control-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="containerShadowEnabled" checked>
                            Enable Container Shadow
                        </label>
                    </div>
                    <div class="control-group">
                        <label>Shadow Horizontal <span class="range-value" id="shadowHValue">0px</span></label>
                        <input type="range" id="shadowH" min="-30" max="30" value="0">
                    </div>
                    <div class="control-group">
                        <label>Shadow Vertical <span class="range-value" id="shadowVValue">20px</span></label>
                        <input type="range" id="shadowV" min="0" max="50" value="20">
                    </div>
                    <div class="control-group">
                        <label>Shadow Blur <span class="range-value" id="shadowBlurValue">60px</span></label>
                        <input type="range" id="shadowBlur" min="0" max="100" value="60">
                    </div>
                    <div class="control-group">
                        <label>Shadow Color</label>
                        <input type="color" id="shadowColor" value="#000000">
                    </div>
                    <div class="control-group">
                        <label>Shadow Opacity <span class="range-value" id="shadowOpacityValue">30%</span></label>
                        <input type="range" id="shadowOpacity" min="0" max="100" value="30">
                    </div>
                </div>

                <div class="control-section">
                    <h2>Text Shadow</h2>
                    <div class="control-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="textShadowEnabled">
                            Enable Text Shadow on Headings
                        </label>
                    </div>
                    <div class="control-group">
                        <label>Text Shadow Horizontal <span class="range-value" id="textShadowHValue">2px</span></label>
                        <input type="range" id="textShadowH" min="-10" max="10" value="2">
                    </div>
                    <div class="control-group">
                        <label>Text Shadow Vertical <span class="range-value" id="textShadowVValue">2px</span></label>
                        <input type="range" id="textShadowV" min="-10" max="10" value="2">
                    </div>
                    <div class="control-group">
                        <label>Text Shadow Blur <span class="range-value" id="textShadowBlurValue">4px</span></label>
                        <input type="range" id="textShadowBlur" min="0" max="20" value="4">
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn" id="saveConfigBtn">ðŸ’¾ Save Configuration</button>
                <button class="btn btn-secondary" id="loadConfigBtn">ðŸ“‚ Load Configuration</button>
                <button class="btn" id="generateBtn">âš¡ Generate & Download HTML</button>
            </div>
        </div>

        <!-- Preview Panel -->
        <div class="preview-panel" id="previewPanel">
            <iframe id="previewFrame" class="preview-frame" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>
    </div>

    <script>
        // Utility Functions

        // HTML Escaping to prevent XSS
        function escapeHtml(unsafe) {
            if (unsafe === null || unsafe === undefined) return '';
            return String(unsafe)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Debounce function for performance
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Sanitize filename
        function sanitizeFilename(filename) {
            return filename
                .replace(/[^a-z0-9]/gi, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '')
                .toLowerCase() || 'resume';
        }

        // Validate email
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // Validate URL
        function isValidUrl(url) {
            try {
                new URL(url);
                return true;
            } catch {
                return false;
            }
        }

        // Configuration Object
        const config = {
            personal: {
                fullName: 'Your Name',
                jobTitle: 'Professional Title',
                email: 'email@example.com',
                phone: '(555) 123-4567',
                location: 'City, State',
                linkedin: '',
                website: '',
                summary: ''
            },
            colors: {
                accent: '#c41e3a',
                secondary: '#ff6b6b',
                bgStart: '#0d1227',
                bgEnd: '#1a1f3a',
                text: '#333333',
                heading: '#1a1f3a'
            },
            typography: {
                fontFamily: 'Inter',
                headingSize: 48,
                subheadingSize: 24,
                bodySize: 14,
                headingWeight: 800,
                bodyWeight: 400,
                letterSpacing: 0,
                lineHeight: 1.6
            },
            textStyling: {
                headingTransform: 'none',
                alignment: 'center',
                shadow: {
                    enabled: false,
                    horizontal: 2,
                    vertical: 2,
                    blur: 4,
                    color: 'rgba(0,0,0,0.3)'
                }
            },
            hoverEffects: {
                enabled: true,
                sectionHover: true,
                hoverColor: '#f8f9fa',
                animation: 'fade',
                shadow: {
                    enabled: true,
                    horizontal: 0,
                    vertical: 4,
                    blur: 12,
                    color: 'rgba(196,30,58,0.2)'
                }
            },
            icons: {
                enabled: true,
                contactIcons: {
                    email: 'âœ‰',
                    phone: 'â˜Ž',
                    location: 'ðŸ“',
                    linkedin: 'ðŸ’¼',
                    website: 'ðŸŒ'
                },
                size: 14,
                color: 'inherit',
                position: 'left'
            },
            spacing: {
                sectionMargin: 35,
                sectionPadding: 0,
                headerPadding: 30
            },
            borders: {
                enabled: true,
                headerBorder: 3,
                sectionBorder: 2,
                borderStyle: 'solid',
                borderRadius: 8
            },
            shadows: {
                containerShadow: {
                    enabled: true,
                    horizontal: 0,
                    vertical: 20,
                    blur: 60,
                    color: 'rgba(0,0,0,0.3)'
                }
            },
            transparency: {
                sheet: 100,
                background: 100
            },
            threeJs: {
                effect: 'none',
                speed: 50,
                particleCount: 1000,
                color: '#c41e3a'
            },
            background: {
                type: 'gradient',
                image: null,
                imageOverlay: 80
            },
            sections: [
                { id: 1, title: 'Professional Summary', content: '', type: 'text' },
                { id: 2, title: 'Experience', content: '', type: 'list' },
                { id: 3, title: 'Education', content: '', type: 'list' },
                { id: 4, title: 'Skills', content: '', type: 'skills' }
            ],
            skills: [
                { name: 'JavaScript', level: 90 },
                { name: 'HTML/CSS', level: 85 },
                { name: 'React', level: 80 }
            ]
        };

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                tab.classList.add('active');
                document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
            });
        });

        // Three.js effect selection
        document.querySelectorAll('.three-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.three-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                this.querySelector('input').checked = true;
                config.threeJs.effect = this.dataset.effect;
                updatePreview();
            });
        });

        // Background type selection
        document.querySelectorAll('.bg-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.bg-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                config.background.type = this.dataset.bg;

                // Show/hide image upload section
                if (this.dataset.bg === 'image') {
                    document.getElementById('imageUploadSection').style.display = 'block';
                } else {
                    document.getElementById('imageUploadSection').style.display = 'none';
                }

                updatePreview();
            });
        });

        // Range input value display with null checks
        function setupRangeInput(inputId, valueId, suffix = '%') {
            const input = document.getElementById(inputId);
            const valueDisplay = document.getElementById(valueId);

            if (!input || !valueDisplay) {
                console.warn(`Range input elements not found: ${inputId}, ${valueId}`);
                return;
            }

            // Initialize display value
            valueDisplay.textContent = input.value + suffix;

            input.addEventListener('input', function() {
                valueDisplay.textContent = this.value + suffix;
            });
        }

        setupRangeInput('sheetOpacity', 'sheetOpacityValue');
        setupRangeInput('bgOpacity', 'bgOpacityValue');
        setupRangeInput('animSpeed', 'animSpeedValue');
        setupRangeInput('particleCount', 'particleCountValue', '');
        setupRangeInput('imgOverlay', 'imgOverlayValue');

        // Personal info inputs with debouncing
        const debouncedUpdatePreview = debounce(updatePreview, 300);

        ['fullName', 'jobTitle', 'email', 'phone', 'location', 'linkedin', 'website', 'summary'].forEach(field => {
            const element = document.getElementById(field);
            if (element) {
                element.addEventListener('input', function() {
                    config.personal[field] = this.value;
                    debouncedUpdatePreview();
                });
            }
        });

        // Color inputs
        ['accentColor', 'secondaryColor', 'bgColorStart', 'bgColorEnd', 'textColor', 'headingColor', 'effectColor'].forEach(colorId => {
            const element = document.getElementById(colorId);
            if (element) {
                element.addEventListener('input', function() {
                    const key = colorId.replace('Color', '').replace('bg', 'bg');
                    if (colorId === 'accentColor') config.colors.accent = this.value;
                    else if (colorId === 'secondaryColor') config.colors.secondary = this.value;
                    else if (colorId === 'bgColorStart') config.colors.bgStart = this.value;
                    else if (colorId === 'bgColorEnd') config.colors.bgEnd = this.value;
                    else if (colorId === 'textColor') config.colors.text = this.value;
                    else if (colorId === 'headingColor') config.colors.heading = this.value;
                    else if (colorId === 'effectColor') config.threeJs.color = this.value;
                    updatePreview();
                });
            }
        });

        // Transparency inputs
        document.getElementById('sheetOpacity').addEventListener('input', function() {
            config.transparency.sheet = this.value;
            updatePreview();
        });

        document.getElementById('bgOpacity').addEventListener('input', function() {
            config.transparency.background = this.value;
            updatePreview();
        });

        // Three.js settings
        document.getElementById('animSpeed').addEventListener('input', function() {
            config.threeJs.speed = this.value;
            updatePreview();
        });

        document.getElementById('particleCount').addEventListener('input', function() {
            config.threeJs.particleCount = this.value;
            updatePreview();
        });

        // Background image upload with error handling
        document.getElementById('bgImageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    alert('Please select a valid image file');
                    return;
                }

                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('Image size must be less than 5MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    config.background.image = event.target.result;
                    updatePreview();
                };
                reader.onerror = function() {
                    alert('Error reading file. Please try again.');
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('imgOverlay').addEventListener('input', function() {
            config.background.imageOverlay = this.value;
            updatePreview();
        });

        // Typography Controls
        setupRangeInput('headingSize', 'headingSizeValue', 'px');
        setupRangeInput('subheadingSize', 'subheadingSizeValue', 'px');
        setupRangeInput('bodySize', 'bodySizeValue', 'px');
        setupRangeInput('headingWeight', 'headingWeightValue', '');
        setupRangeInput('bodyWeight', 'bodyWeightValue', '');
        setupRangeInput('letterSpacing', 'letterSpacingValue', 'px');
        setupRangeInput('lineHeight', 'lineHeightValue', '');

        document.getElementById('fontFamily').addEventListener('change', function() {
            config.typography.fontFamily = this.value;
            updatePreview();
        });

        document.getElementById('headingSize').addEventListener('input', function() {
            config.typography.headingSize = this.value;
            updatePreview();
        });

        document.getElementById('subheadingSize').addEventListener('input', function() {
            config.typography.subheadingSize = this.value;
            updatePreview();
        });

        document.getElementById('bodySize').addEventListener('input', function() {
            config.typography.bodySize = this.value;
            updatePreview();
        });

        document.getElementById('headingWeight').addEventListener('input', function() {
            config.typography.headingWeight = this.value;
            updatePreview();
        });

        document.getElementById('bodyWeight').addEventListener('input', function() {
            config.typography.bodyWeight = this.value;
            updatePreview();
        });

        document.getElementById('letterSpacing').addEventListener('input', function() {
            config.typography.letterSpacing = this.value;
            updatePreview();
        });

        document.getElementById('lineHeight').addEventListener('input', function() {
            config.typography.lineHeight = this.value;
            updatePreview();
        });

        document.getElementById('headingTransform').addEventListener('change', function() {
            config.textStyling.headingTransform = this.value;
            updatePreview();
        });

        document.getElementById('headerAlignment').addEventListener('change', function() {
            config.textStyling.alignment = this.value;
            updatePreview();
        });

        // Hover Effects Controls
        setupRangeInput('hoverShadowH', 'hoverShadowHValue', 'px');
        setupRangeInput('hoverShadowV', 'hoverShadowVValue', 'px');
        setupRangeInput('hoverShadowBlur', 'hoverShadowBlurValue', 'px');

        document.getElementById('hoverEnabled').addEventListener('change', function() {
            config.hoverEffects.enabled = this.checked;
            updatePreview();
        });

        document.getElementById('sectionHover').addEventListener('change', function() {
            config.hoverEffects.sectionHover = this.checked;
            updatePreview();
        });

        document.getElementById('hoverColor').addEventListener('input', function() {
            config.hoverEffects.hoverColor = this.value;
            updatePreview();
        });

        document.getElementById('hoverAnimation').addEventListener('change', function() {
            config.hoverEffects.animation = this.value;
            updatePreview();
        });

        document.getElementById('hoverShadowEnabled').addEventListener('change', function() {
            config.hoverEffects.shadow.enabled = this.checked;
            updatePreview();
        });

        document.getElementById('hoverShadowH').addEventListener('input', function() {
            config.hoverEffects.shadow.horizontal = this.value;
            updatePreview();
        });

        document.getElementById('hoverShadowV').addEventListener('input', function() {
            config.hoverEffects.shadow.vertical = this.value;
            updatePreview();
        });

        document.getElementById('hoverShadowBlur').addEventListener('input', function() {
            config.hoverEffects.shadow.blur = this.value;
            updatePreview();
        });

        document.getElementById('hoverShadowColor').addEventListener('input', function() {
            const hex = this.value;
            // Convert hex to rgba
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            config.hoverEffects.shadow.color = `rgba(${r},${g},${b},0.2)`;
            updatePreview();
        });

        // Icons Controls
        setupRangeInput('iconSize', 'iconSizeValue', 'px');

        document.getElementById('iconsEnabled').addEventListener('change', function() {
            config.icons.enabled = this.checked;
            updatePreview();
        });

        document.getElementById('iconSize').addEventListener('input', function() {
            config.icons.size = this.value;
            updatePreview();
        });

        document.getElementById('iconPosition').addEventListener('change', function() {
            config.icons.position = this.value;
            updatePreview();
        });

        ['iconEmail', 'iconPhone', 'iconLocation', 'iconLinkedin', 'iconWebsite'].forEach(iconId => {
            const element = document.getElementById(iconId);
            if (element) {
                element.addEventListener('input', function() {
                    const key = iconId.replace('icon', '').toLowerCase();
                    config.icons.contactIcons[key] = this.value;
                    updatePreview();
                });
            }
        });

        // Advanced Controls - Spacing
        setupRangeInput('sectionMargin', 'sectionMarginValue', 'px');
        setupRangeInput('sectionPadding', 'sectionPaddingValue', 'px');
        setupRangeInput('headerPadding', 'headerPaddingValue', 'px');

        document.getElementById('sectionMargin').addEventListener('input', function() {
            config.spacing.sectionMargin = this.value;
            updatePreview();
        });

        document.getElementById('sectionPadding').addEventListener('input', function() {
            config.spacing.sectionPadding = this.value;
            updatePreview();
        });

        document.getElementById('headerPadding').addEventListener('input', function() {
            config.spacing.headerPadding = this.value;
            updatePreview();
        });

        // Advanced Controls - Borders
        setupRangeInput('headerBorder', 'headerBorderValue', 'px');
        setupRangeInput('sectionBorder', 'sectionBorderValue', 'px');
        setupRangeInput('borderRadius', 'borderRadiusValue', 'px');

        document.getElementById('bordersEnabled').addEventListener('change', function() {
            config.borders.enabled = this.checked;
            updatePreview();
        });

        document.getElementById('headerBorder').addEventListener('input', function() {
            config.borders.headerBorder = this.value;
            updatePreview();
        });

        document.getElementById('sectionBorder').addEventListener('input', function() {
            config.borders.sectionBorder = this.value;
            updatePreview();
        });

        document.getElementById('borderStyle').addEventListener('change', function() {
            config.borders.borderStyle = this.value;
            updatePreview();
        });

        document.getElementById('borderRadius').addEventListener('input', function() {
            config.borders.borderRadius = this.value;
            updatePreview();
        });

        // Advanced Controls - Shadows
        setupRangeInput('shadowH', 'shadowHValue', 'px');
        setupRangeInput('shadowV', 'shadowVValue', 'px');
        setupRangeInput('shadowBlur', 'shadowBlurValue', 'px');
        setupRangeInput('shadowOpacity', 'shadowOpacityValue', '%');
        setupRangeInput('textShadowH', 'textShadowHValue', 'px');
        setupRangeInput('textShadowV', 'textShadowVValue', 'px');
        setupRangeInput('textShadowBlur', 'textShadowBlurValue', 'px');

        document.getElementById('containerShadowEnabled').addEventListener('change', function() {
            config.shadows.containerShadow.enabled = this.checked;
            updatePreview();
        });

        document.getElementById('shadowH').addEventListener('input', function() {
            config.shadows.containerShadow.horizontal = this.value;
            updatePreview();
        });

        document.getElementById('shadowV').addEventListener('input', function() {
            config.shadows.containerShadow.vertical = this.value;
            updatePreview();
        });

        document.getElementById('shadowBlur').addEventListener('input', function() {
            config.shadows.containerShadow.blur = this.value;
            updatePreview();
        });

        document.getElementById('shadowColor').addEventListener('input', function() {
            const hex = this.value;
            const opacity = document.getElementById('shadowOpacity').value / 100;
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            config.shadows.containerShadow.color = `rgba(${r},${g},${b},${opacity})`;
            updatePreview();
        });

        document.getElementById('shadowOpacity').addEventListener('input', function() {
            const hex = document.getElementById('shadowColor').value;
            const opacity = this.value / 100;
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            config.shadows.containerShadow.color = `rgba(${r},${g},${b},${opacity})`;
            updatePreview();
        });

        document.getElementById('textShadowEnabled').addEventListener('change', function() {
            config.textStyling.shadow.enabled = this.checked;
            updatePreview();
        });

        document.getElementById('textShadowH').addEventListener('input', function() {
            config.textStyling.shadow.horizontal = this.value;
            updatePreview();
        });

        document.getElementById('textShadowV').addEventListener('input', function() {
            config.textStyling.shadow.vertical = this.value;
            updatePreview();
        });

        document.getElementById('textShadowBlur').addEventListener('input', function() {
            config.textStyling.shadow.blur = this.value;
            updatePreview();
        });

        // Sections management
        function renderSections() {
            const container = document.getElementById('sectionsList');
            container.innerHTML = '';

            config.sections.forEach((section, index) => {
                const sectionEl = document.createElement('div');
                sectionEl.className = 'section-item';

                // Create section header
                const headerDiv = document.createElement('div');
                headerDiv.className = 'section-item-header';

                const titleSpan = document.createElement('span');
                titleSpan.className = 'section-item-title';
                titleSpan.textContent = section.title;

                const controlsDiv = document.createElement('div');
                controlsDiv.className = 'section-item-controls';

                // Move up button
                if (index > 0) {
                    const upBtn = document.createElement('button');
                    upBtn.className = 'icon-btn';
                    upBtn.textContent = 'â†‘';
                    upBtn.setAttribute('aria-label', 'Move section up');
                    upBtn.addEventListener('click', () => moveSectionUp(index));
                    controlsDiv.appendChild(upBtn);
                }

                // Move down button
                if (index < config.sections.length - 1) {
                    const downBtn = document.createElement('button');
                    downBtn.className = 'icon-btn';
                    downBtn.textContent = 'â†“';
                    downBtn.setAttribute('aria-label', 'Move section down');
                    downBtn.addEventListener('click', () => moveSectionDown(index));
                    controlsDiv.appendChild(downBtn);
                }

                // Edit button
                const editBtn = document.createElement('button');
                editBtn.className = 'icon-btn';
                editBtn.textContent = 'âœŽ';
                editBtn.setAttribute('aria-label', 'Edit section');
                editBtn.addEventListener('click', () => editSection(index));
                controlsDiv.appendChild(editBtn);

                // Delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'icon-btn';
                deleteBtn.textContent = 'âœ•';
                deleteBtn.setAttribute('aria-label', 'Delete section');
                deleteBtn.addEventListener('click', () => deleteSection(index));
                controlsDiv.appendChild(deleteBtn);

                headerDiv.appendChild(titleSpan);
                headerDiv.appendChild(controlsDiv);

                // Create collapsible content
                const contentDiv = document.createElement('div');
                contentDiv.className = 'collapsible-content';
                contentDiv.id = `section-content-${index}`;

                const titleGroup = document.createElement('div');
                titleGroup.className = 'control-group';
                const titleLabel = document.createElement('label');
                titleLabel.textContent = 'Section Title';
                const titleInput = document.createElement('input');
                titleInput.type = 'text';
                titleInput.value = section.title;
                titleInput.addEventListener('change', (e) => updateSectionTitle(index, e.target.value));
                titleGroup.appendChild(titleLabel);
                titleGroup.appendChild(titleInput);

                const contentGroup = document.createElement('div');
                contentGroup.className = 'control-group';
                const contentLabel = document.createElement('label');
                contentLabel.textContent = 'Content';
                const contentTextarea = document.createElement('textarea');
                contentTextarea.placeholder = 'Enter content for this section...';
                contentTextarea.value = section.content;
                contentTextarea.addEventListener('change', (e) => updateSectionContent(index, e.target.value));
                contentGroup.appendChild(contentLabel);
                contentGroup.appendChild(contentTextarea);

                contentDiv.appendChild(titleGroup);
                contentDiv.appendChild(contentGroup);

                sectionEl.appendChild(headerDiv);
                sectionEl.appendChild(contentDiv);
                container.appendChild(sectionEl);
            });
        }

        function addSection() {
            const newSection = {
                id: Date.now(),
                title: 'New Section',
                content: '',
                type: 'text'
            };
            config.sections.push(newSection);
            renderSections();
            updatePreview();
        }

        function deleteSection(index) {
            if (confirm('Are you sure you want to delete this section?')) {
                config.sections.splice(index, 1);
                renderSections();
                updatePreview();
            }
        }

        function moveSectionUp(index) {
            if (index > 0) {
                [config.sections[index], config.sections[index - 1]] = [config.sections[index - 1], config.sections[index]];
                renderSections();
                updatePreview();
            }
        }

        function moveSectionDown(index) {
            if (index < config.sections.length - 1) {
                [config.sections[index], config.sections[index + 1]] = [config.sections[index + 1], config.sections[index]];
                renderSections();
                updatePreview();
            }
        }

        function updateSectionTitle(index, value) {
            config.sections[index].title = value;
            renderSections();
            updatePreview();
        }

        function updateSectionContent(index, value) {
            config.sections[index].content = value;
            updatePreview();
        }

        function editSection(index) {
            const content = document.getElementById(`section-content-${index}`);
            content.classList.toggle('open');
        }

        document.getElementById('addSectionBtn').addEventListener('click', addSection);

        // Skills management
        function renderSkills() {
            const container = document.getElementById('skillsList');
            container.innerHTML = '';

            config.skills.forEach((skill, index) => {
                const skillEl = document.createElement('div');
                skillEl.className = 'skill-entry';

                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.placeholder = 'Skill name';
                nameInput.value = skill.name;
                nameInput.addEventListener('change', (e) => updateSkillName(index, e.target.value));

                const levelInput = document.createElement('input');
                levelInput.type = 'number';
                levelInput.min = '0';
                levelInput.max = '100';
                levelInput.placeholder = 'Level';
                levelInput.value = skill.level;
                levelInput.addEventListener('change', (e) => updateSkillLevel(index, e.target.value));

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'icon-btn';
                deleteBtn.textContent = 'âœ•';
                deleteBtn.setAttribute('aria-label', `Delete skill ${skill.name || 'entry'}`);
                deleteBtn.addEventListener('click', () => deleteSkill(index));

                skillEl.appendChild(nameInput);
                skillEl.appendChild(levelInput);
                skillEl.appendChild(deleteBtn);
                container.appendChild(skillEl);
            });
        }

        function addSkill() {
            config.skills.push({ name: '', level: 50 });
            renderSkills();
            updatePreview();
        }

        function deleteSkill(index) {
            config.skills.splice(index, 1);
            renderSkills();
            updatePreview();
        }

        function updateSkillName(index, value) {
            config.skills[index].name = value;
            updatePreview();
        }

        function updateSkillLevel(index, value) {
            config.skills[index].level = Math.min(100, Math.max(0, parseInt(value) || 0));
            updatePreview();
        }

        document.getElementById('addSkillBtn').addEventListener('click', addSkill);

        // Preview update
        function updatePreview() {
            const iframe = document.getElementById('previewFrame');
            const html = generateHTML();

            iframe.srcdoc = html;
        }

        // Generate HTML with proper escaping
        function generateHTML() {
            const fontFamilyUrl = config.typography.fontFamily.replace(' ', '+');
            const contactIcon = (type) => config.icons.enabled ? config.icons.contactIcons[type] + ' ' : '';
            const hoverAnimationCSS = config.hoverEffects.enabled && config.hoverEffects.sectionHover ?
                `transition: all 0.3s ease;` +
                (config.hoverEffects.animation === 'lift' ? `&:hover { transform: translateY(-4px); }` :
                 config.hoverEffects.animation === 'scale' ? `&:hover { transform: scale(1.02); }` :
                 config.hoverEffects.animation === 'glow' ? `&:hover { box-shadow: 0 0 20px ${config.hoverEffects.shadow.color}; }` :
                 `&:hover { background: ${config.hoverEffects.hoverColor}; }`)
                : '';

            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${escapeHtml(config.personal.fullName)} - Resume</title>
    <link href="https://fonts.googleapis.com/css2?family=${fontFamilyUrl}:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <scr` + `ipt src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></scr` + `ipt>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: '${config.typography.fontFamily}', sans-serif;
            background: ${getBackgroundStyle()};
            color: ${config.colors.text};
            font-size: ${config.typography.bodySize}px;
            font-weight: ${config.typography.bodyWeight};
            line-height: ${config.typography.lineHeight};
            letter-spacing: ${config.typography.letterSpacing}px;
            padding: 40px 20px;
            position: relative;
            overflow-x: hidden;
        }
        .three-canvas-left, .three-canvas-right {
            position: fixed;
            top: 0;
            width: 25%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }
        .three-canvas-left { left: 0; }
        .three-canvas-right { right: 0; }
        .resume-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, ${config.transparency.sheet / 100});
            padding: 60px;
            ${config.shadows.containerShadow.enabled ? `box-shadow: ${config.shadows.containerShadow.horizontal}px ${config.shadows.containerShadow.vertical}px ${config.shadows.containerShadow.blur}px ${config.shadows.containerShadow.color};` : 'box-shadow: none;'}
            position: relative;
            z-index: 1;
            border-radius: ${config.borders.borderRadius}px;
        }
        .header {
            text-align: ${config.textStyling.alignment};
            margin-bottom: 40px;
            padding-bottom: ${config.spacing.headerPadding}px;
            ${config.borders.enabled && config.borders.headerBorder > 0 ? `border-bottom: ${config.borders.headerBorder}px ${config.borders.borderStyle} ${config.colors.accent};` : ''}
        }
        h1 {
            font-size: ${config.typography.headingSize}px;
            font-weight: ${config.typography.headingWeight};
            color: ${config.colors.heading};
            text-transform: ${config.textStyling.headingTransform};
            margin-bottom: 10px;
            background: linear-gradient(135deg, ${config.colors.accent} 0%, ${config.colors.secondary} 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            ${config.textStyling.shadow.enabled ? `text-shadow: ${config.textStyling.shadow.horizontal}px ${config.textStyling.shadow.vertical}px ${config.textStyling.shadow.blur}px ${config.textStyling.shadow.color};` : ''}
        }
        .job-title {
            font-size: ${Math.round(config.typography.headingSize * 0.42)}px;
            color: ${config.colors.accent};
            font-weight: 600;
            margin-bottom: 15px;
        }
        .contact-info {
            display: flex;
            justify-content: ${config.textStyling.alignment === 'center' ? 'center' : config.textStyling.alignment === 'right' ? 'flex-end' : 'flex-start'};
            gap: 20px;
            flex-wrap: wrap;
            font-size: ${config.typography.bodySize}px;
            color: #666;
        }
        .contact-info span {
            ${config.icons.enabled ? `font-size: ${config.icons.size}px;` : ''}
        }
        .contact-info a {
            color: ${config.colors.accent};
            text-decoration: none;
        }
        .section {
            margin-bottom: ${config.spacing.sectionMargin}px;
            padding: ${config.spacing.sectionPadding}px;
            ${config.hoverEffects.enabled && config.hoverEffects.sectionHover ? `
            transition: all 0.3s ease;
            border-radius: 6px;
            ` : ''}
        }
        ${config.hoverEffects.enabled && config.hoverEffects.sectionHover ? `
        .section:hover {
            ${config.hoverEffects.animation === 'fade' ? `background: ${config.hoverEffects.hoverColor};` : ''}
            ${config.hoverEffects.animation === 'lift' ? `transform: translateY(-4px);` : ''}
            ${config.hoverEffects.animation === 'scale' ? `transform: scale(1.02);` : ''}
            ${config.hoverEffects.animation === 'glow' ? `box-shadow: 0 0 20px ${config.hoverEffects.shadow.color};` : ''}
            ${config.hoverEffects.shadow.enabled ? `box-shadow: ${config.hoverEffects.shadow.horizontal}px ${config.hoverEffects.shadow.vertical}px ${config.hoverEffects.shadow.blur}px ${config.hoverEffects.shadow.color};` : ''}
        }
        ` : ''}
        .section h2 {
            font-size: ${config.typography.subheadingSize}px;
            color: ${config.colors.heading};
            margin-bottom: 15px;
            padding-bottom: 8px;
            ${config.borders.enabled && config.borders.sectionBorder > 0 ? `border-bottom: ${config.borders.sectionBorder}px ${config.borders.borderStyle} ${config.colors.accent};` : ''}
        }
        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .skill-item {
            margin-bottom: 10px;
        }
        .skill-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: ${config.colors.heading};
        }
        .skill-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }
        .skill-level {
            height: 100%;
            background: linear-gradient(90deg, ${config.colors.accent}, ${config.colors.secondary});
            border-radius: 4px;
            transition: width 1s ease-out;
        }
        @media print {
            body { padding: 0; background: white; }
            .resume-container { box-shadow: none; padding: 40px; }
            .three-canvas-left, .three-canvas-right { display: none; }
        }
    </style>
</head>
<body>
    ${config.threeJs.effect !== 'none' ? `<canvas class="three-canvas-left" id="threeCanvasLeft"></canvas><canvas class="three-canvas-right" id="threeCanvasRight"></canvas>` : ''}
    <div class="resume-container">
        <div class="header">
            <h1>${escapeHtml(config.personal.fullName)}</h1>
            <div class="job-title">${escapeHtml(config.personal.jobTitle)}</div>
            <div class="contact-info">
                ${config.personal.email ? `<span>${contactIcon('email')}${escapeHtml(config.personal.email)}</span>` : ''}
                ${config.personal.phone ? `<span>${contactIcon('phone')}${escapeHtml(config.personal.phone)}</span>` : ''}
                ${config.personal.location ? `<span>${contactIcon('location')}${escapeHtml(config.personal.location)}</span>` : ''}
                ${config.personal.linkedin && isValidUrl(config.personal.linkedin) ? `<span>${contactIcon('linkedin')}<a href="${escapeHtml(config.personal.linkedin)}" target="_blank" rel="noopener noreferrer">LinkedIn</a></span>` : ''}
                ${config.personal.website && isValidUrl(config.personal.website) ? `<span>${contactIcon('website')}<a href="${escapeHtml(config.personal.website)}" target="_blank" rel="noopener noreferrer">Website</a></span>` : ''}
            </div>
        </div>

        ${config.personal.summary ? `
        <div class="section">
            <h2>Professional Summary</h2>
            <p>${escapeHtml(config.personal.summary)}</p>
        </div>
        ` : ''}

        ${config.sections.map(section => `
        <div class="section">
            <h2>${escapeHtml(section.title)}</h2>
            <p>${escapeHtml(section.content) || 'Content coming soon...'}</p>
        </div>
        `).join('')}

        ${config.skills.length > 0 ? `
        <div class="section">
            <h2>Technical Skills</h2>
            <div class="skills-grid">
                ${config.skills.map(skill => `
                <div class="skill-item">
                    <div class="skill-name">${escapeHtml(skill.name)}</div>
                    <div class="skill-bar">
                        <div class="skill-level" style="width: ${Math.min(100, Math.max(0, parseInt(skill.level) || 0))}%"></div>
                    </div>
                </div>
                `).join('')}
            </div>
        </div>
        ` : ''}
    </div>

    <scr` + `ipt>
        ${getThreeJsCode()}
    </scr` + `ipt>
</body>
</html>`;
        }

        function getBackgroundStyle() {
            const opacity = config.transparency.background / 100;

            switch(config.background.type) {
                case 'solid':
                    return `rgba(${hexToRgb(config.colors.bgStart)}, ${opacity})`;
                case 'gradient':
                    return `linear-gradient(135deg, ${config.colors.bgStart} 0%, ${config.colors.bgEnd} 100%)`;
                case 'pattern':
                    return `repeating-linear-gradient(45deg, ${config.colors.bgStart}, ${config.colors.bgStart} 10px, ${config.colors.bgEnd} 10px, ${config.colors.bgEnd} 20px)`;
                case 'image':
                    if (config.background.image) {
                        const overlayOpacity = config.background.imageOverlay / 100;
                        return `linear-gradient(rgba(${hexToRgb(config.colors.bgStart)}, ${overlayOpacity}), rgba(${hexToRgb(config.colors.bgEnd)}, ${overlayOpacity})), url(${config.background.image}) center/cover`;
                    }
                    return `linear-gradient(135deg, ${config.colors.bgStart} 0%, ${config.colors.bgEnd} 100%)`;
                default:
                    return `linear-gradient(135deg, ${config.colors.bgStart} 0%, ${config.colors.bgEnd} 100%)`;
            }
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '0, 0, 0';
        }

        function getThreeJsCode() {
            if (config.threeJs.effect === 'none') {
                return '// No Three.js effect selected';
            }

            const baseCode = `
                // Left canvas setup
                const canvasLeft = document.getElementById('threeCanvasLeft');
                const sceneLeft = new THREE.Scene();
                const cameraLeft = new THREE.PerspectiveCamera(75, canvasLeft.clientWidth / canvasLeft.clientHeight, 0.1, 1000);
                const rendererLeft = new THREE.WebGLRenderer({ canvas: canvasLeft, alpha: true });
                rendererLeft.setSize(canvasLeft.clientWidth, canvasLeft.clientHeight);
                cameraLeft.position.z = 5;

                // Right canvas setup
                const canvasRight = document.getElementById('threeCanvasRight');
                const sceneRight = new THREE.Scene();
                const cameraRight = new THREE.PerspectiveCamera(75, canvasRight.clientWidth / canvasRight.clientHeight, 0.1, 1000);
                const rendererRight = new THREE.WebGLRenderer({ canvas: canvasRight, alpha: true });
                rendererRight.setSize(canvasRight.clientWidth, canvasRight.clientHeight);
                cameraRight.position.z = 5;

                const speed = ${config.threeJs.speed / 50};
                const color = new THREE.Color('${config.threeJs.color}');
            `;

            let effectCode = '';

            switch(config.threeJs.effect) {
                case 'particles':
                    effectCode = `
                        const geometryLeft = new THREE.BufferGeometry();
                        const geometryRight = new THREE.BufferGeometry();
                        const positionsLeft = [];
                        const positionsRight = [];
                        for (let i = 0; i < ${config.threeJs.particleCount / 2}; i++) {
                            positionsLeft.push((Math.random() - 0.5) * 20);
                            positionsLeft.push((Math.random() - 0.5) * 20);
                            positionsLeft.push((Math.random() - 0.5) * 20);
                            positionsRight.push((Math.random() - 0.5) * 20);
                            positionsRight.push((Math.random() - 0.5) * 20);
                            positionsRight.push((Math.random() - 0.5) * 20);
                        }
                        geometryLeft.setAttribute('position', new THREE.Float32BufferAttribute(positionsLeft, 3));
                        geometryRight.setAttribute('position', new THREE.Float32BufferAttribute(positionsRight, 3));
                        const material = new THREE.PointsMaterial({ color: color, size: 0.05 });
                        const particlesLeft = new THREE.Points(geometryLeft, material.clone());
                        const particlesRight = new THREE.Points(geometryRight, material.clone());
                        sceneLeft.add(particlesLeft);
                        sceneRight.add(particlesRight);

                        function animate() {
                            requestAnimationFrame(animate);
                            particlesLeft.rotation.y += 0.001 * speed;
                            particlesRight.rotation.y -= 0.001 * speed;
                            rendererLeft.render(sceneLeft, cameraLeft);
                            rendererRight.render(sceneRight, cameraRight);
                        }
                        animate();
                    `;
                    break;

                case 'waves':
                    effectCode = `
                        const geometryLeft = new THREE.PlaneGeometry(20, 20, 50, 50);
                        const geometryRight = new THREE.PlaneGeometry(20, 20, 50, 50);
                        const material = new THREE.MeshBasicMaterial({ color: color, wireframe: true });
                        const planeLeft = new THREE.Mesh(geometryLeft, material.clone());
                        const planeRight = new THREE.Mesh(geometryRight, material.clone());
                        planeLeft.rotation.x = -Math.PI / 2;
                        planeRight.rotation.x = -Math.PI / 2;
                        sceneLeft.add(planeLeft);
                        sceneRight.add(planeRight);

                        let time = 0;
                        function animate() {
                            requestAnimationFrame(animate);
                            time += 0.01 * speed;
                            const positionsLeft = geometryLeft.attributes.position.array;
                            const positionsRight = geometryRight.attributes.position.array;
                            for (let i = 0; i < positionsLeft.length; i += 3) {
                                const x = positionsLeft[i];
                                const y = positionsLeft[i + 1];
                                positionsLeft[i + 2] = Math.sin(x * 0.5 + time) * Math.cos(y * 0.5 + time) * 0.5;
                                positionsRight[i + 2] = Math.sin(positionsRight[i] * 0.5 - time) * Math.cos(positionsRight[i + 1] * 0.5 - time) * 0.5;
                            }
                            geometryLeft.attributes.position.needsUpdate = true;
                            geometryRight.attributes.position.needsUpdate = true;
                            rendererLeft.render(sceneLeft, cameraLeft);
                            rendererRight.render(sceneRight, cameraRight);
                        }
                        animate();
                    `;
                    break;

                case 'geometry':
                    effectCode = `
                        const geometry = new THREE.IcosahedronGeometry(2, 1);
                        const material = new THREE.MeshBasicMaterial({ color: color, wireframe: true });
                        const meshLeft = new THREE.Mesh(geometry.clone(), material.clone());
                        const meshRight = new THREE.Mesh(geometry.clone(), material.clone());
                        sceneLeft.add(meshLeft);
                        sceneRight.add(meshRight);

                        function animate() {
                            requestAnimationFrame(animate);
                            meshLeft.rotation.x += 0.01 * speed;
                            meshLeft.rotation.y += 0.01 * speed;
                            meshRight.rotation.x -= 0.01 * speed;
                            meshRight.rotation.y -= 0.01 * speed;
                            rendererLeft.render(sceneLeft, cameraLeft);
                            rendererRight.render(sceneRight, cameraRight);
                        }
                        animate();
                    `;
                    break;

                case 'network':
                    effectCode = `
                        const nodesLeft = [];
                        const nodesRight = [];
                        const nodeGeometry = new THREE.SphereGeometry(0.05, 8, 8);
                        const nodeMaterial = new THREE.MeshBasicMaterial({ color: color });

                        for (let i = 0; i < 25; i++) {
                            const nodeLeft = new THREE.Mesh(nodeGeometry, nodeMaterial.clone());
                            nodeLeft.position.set(
                                (Math.random() - 0.5) * 10,
                                (Math.random() - 0.5) * 10,
                                (Math.random() - 0.5) * 10
                            );
                            nodesLeft.push(nodeLeft);
                            sceneLeft.add(nodeLeft);

                            const nodeRight = new THREE.Mesh(nodeGeometry, nodeMaterial.clone());
                            nodeRight.position.set(
                                (Math.random() - 0.5) * 10,
                                (Math.random() - 0.5) * 10,
                                (Math.random() - 0.5) * 10
                            );
                            nodesRight.push(nodeRight);
                            sceneRight.add(nodeRight);
                        }

                        function animate() {
                            requestAnimationFrame(animate);

                            nodesLeft.forEach(node => {
                                node.position.y += Math.sin(Date.now() * 0.001 * speed) * 0.01;
                            });
                            nodesRight.forEach(node => {
                                node.position.y -= Math.sin(Date.now() * 0.001 * speed) * 0.01;
                            });

                            rendererLeft.render(sceneLeft, cameraLeft);
                            rendererRight.render(sceneRight, cameraRight);
                        }
                        animate();
                    `;
                    break;

                case 'galaxy':
                    effectCode = `
                        const geometryLeft = new THREE.BufferGeometry();
                        const geometryRight = new THREE.BufferGeometry();
                        const positionsLeft = [];
                        const positionsRight = [];
                        const colors = [];

                        for (let i = 0; i < ${config.threeJs.particleCount / 2}; i++) {
                            const radius = Math.random() * 5;
                            const spinAngle = radius * 5;
                            const branchAngle = (i % 3) * ((Math.PI * 2) / 3);

                            positionsLeft.push(
                                Math.cos(branchAngle + spinAngle) * radius,
                                (Math.random() - 0.5) * 0.5,
                                Math.sin(branchAngle + spinAngle) * radius
                            );
                            positionsRight.push(
                                Math.cos(branchAngle - spinAngle) * radius,
                                (Math.random() - 0.5) * 0.5,
                                Math.sin(branchAngle - spinAngle) * radius
                            );

                            colors.push(color.r, color.g, color.b);
                        }

                        geometryLeft.setAttribute('position', new THREE.Float32BufferAttribute(positionsLeft, 3));
                        geometryLeft.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
                        geometryRight.setAttribute('position', new THREE.Float32BufferAttribute(positionsRight, 3));
                        geometryRight.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

                        const material = new THREE.PointsMaterial({ size: 0.05, vertexColors: true });
                        const galaxyLeft = new THREE.Points(geometryLeft, material.clone());
                        const galaxyRight = new THREE.Points(geometryRight, material.clone());
                        sceneLeft.add(galaxyLeft);
                        sceneRight.add(galaxyRight);

                        function animate() {
                            requestAnimationFrame(animate);
                            galaxyLeft.rotation.y += 0.001 * speed;
                            galaxyRight.rotation.y -= 0.001 * speed;
                            rendererLeft.render(sceneLeft, cameraLeft);
                            rendererRight.render(sceneRight, cameraRight);
                        }
                        animate();
                    `;
                    break;
            }

            return baseCode + effectCode + `
                window.addEventListener('resize', () => {
                    const leftWidth = canvasLeft.clientWidth;
                    const leftHeight = canvasLeft.clientHeight;
                    const rightWidth = canvasRight.clientWidth;
                    const rightHeight = canvasRight.clientHeight;

                    cameraLeft.aspect = leftWidth / leftHeight;
                    cameraLeft.updateProjectionMatrix();
                    rendererLeft.setSize(leftWidth, leftHeight);

                    cameraRight.aspect = rightWidth / rightHeight;
                    cameraRight.updateProjectionMatrix();
                    rendererRight.setSize(rightWidth, rightHeight);
                });
            `;
        }

        // Save/Load configuration with error handling
        document.getElementById('saveConfigBtn').addEventListener('click', () => {
            try {
                // Save to localStorage with error handling
                try {
                    localStorage.setItem('resumeConfig', JSON.stringify(config));
                } catch (storageError) {
                    console.warn('Could not save to localStorage:', storageError);
                }

                // Download as file
                const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'resume-config.json';
                a.click();

                // Clean up blob URL to prevent memory leak
                setTimeout(() => URL.revokeObjectURL(url), 100);

                showMessage('Configuration saved!');
            } catch (error) {
                alert('Error saving configuration: ' + error.message);
            }
        });

        document.getElementById('loadConfigBtn').addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                // Validate file size (max 1MB for config)
                if (file.size > 1024 * 1024) {
                    alert('Configuration file is too large (max 1MB)');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const loadedConfig = JSON.parse(event.target.result);

                        // Validate loaded config structure
                        if (!loadedConfig.personal || !loadedConfig.colors) {
                            throw new Error('Invalid configuration file format');
                        }

                        // Deep merge to preserve structure
                        Object.keys(loadedConfig).forEach(key => {
                            if (config.hasOwnProperty(key)) {
                                if (Array.isArray(loadedConfig[key])) {
                                    config[key] = [...loadedConfig[key]];
                                } else if (typeof loadedConfig[key] === 'object') {
                                    config[key] = { ...config[key], ...loadedConfig[key] };
                                } else {
                                    config[key] = loadedConfig[key];
                                }
                            }
                        });

                        loadConfigToUI();
                        updatePreview();
                        showMessage('Configuration loaded!');
                    } catch (error) {
                        alert('Error loading configuration: ' + error.message);
                    }
                };
                reader.onerror = () => {
                    alert('Error reading file. Please try again.');
                };
                reader.readAsText(file);
            };
            input.click();
        });

        function loadConfigToUI() {
            document.getElementById('fullName').value = config.personal.fullName;
            document.getElementById('jobTitle').value = config.personal.jobTitle;
            document.getElementById('email').value = config.personal.email;
            document.getElementById('phone').value = config.personal.phone;
            document.getElementById('location').value = config.personal.location;
            document.getElementById('linkedin').value = config.personal.linkedin;
            document.getElementById('website').value = config.personal.website;
            document.getElementById('summary').value = config.personal.summary;

            document.getElementById('accentColor').value = config.colors.accent;
            document.getElementById('secondaryColor').value = config.colors.secondary;
            document.getElementById('bgColorStart').value = config.colors.bgStart;
            document.getElementById('bgColorEnd').value = config.colors.bgEnd;
            document.getElementById('textColor').value = config.colors.text;
            document.getElementById('headingColor').value = config.colors.heading;

            document.getElementById('sheetOpacity').value = config.transparency.sheet;
            document.getElementById('bgOpacity').value = config.transparency.background;

            renderSections();
            renderSkills();
        }

        // Generate and download HTML with proper filename sanitization
        document.getElementById('generateBtn').addEventListener('click', () => {
            try {
                const html = generateHTML();
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;

                // Sanitize filename to prevent issues
                const safeName = sanitizeFilename(config.personal.fullName);
                a.download = `${safeName}-resume.html`;

                a.click();

                // Clean up blob URL to prevent memory leak
                setTimeout(() => URL.revokeObjectURL(url), 100);

                showMessage('Resume generated and downloaded!');
            } catch (error) {
                alert('Error generating resume: ' + error.message);
            }
        });

        function showMessage(text) {
            const msg = document.createElement('div');
            msg.className = 'success-message';
            msg.textContent = text;
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
        }

        // Initialize
        renderSections();
        renderSkills();
        updatePreview();

        // Load saved config if exists with proper error handling
        try {
            const saved = localStorage.getItem('resumeConfig');
            if (saved) {
                const savedConfig = JSON.parse(saved);

                // Validate structure before loading
                if (savedConfig && typeof savedConfig === 'object') {
                    // Deep merge saved config
                    Object.keys(savedConfig).forEach(key => {
                        if (config.hasOwnProperty(key)) {
                            if (Array.isArray(savedConfig[key])) {
                                config[key] = [...savedConfig[key]];
                            } else if (typeof savedConfig[key] === 'object' && savedConfig[key] !== null) {
                                config[key] = { ...config[key], ...savedConfig[key] };
                            } else {
                                config[key] = savedConfig[key];
                            }
                        }
                    });

                    loadConfigToUI();
                    console.log('Previous configuration loaded from localStorage');
                }
            }
        } catch (e) {
            console.warn('Could not load saved configuration:', e.message);
            // Continue with default config - not a critical error
        }
    </script>
</body>
</html>
